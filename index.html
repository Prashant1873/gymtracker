<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gym Streak Tracker</title>
  <style>
    /* ---- SAME CSS AS YOUR ORIGINAL (UNCHANGED) ---- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 600px; margin: 0 auto; }
    .card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }
    .hidden { display: none; }
    .user-btn {
      width: 100%;
      padding: 18px;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
    }
    .streak-badge {
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
    }
    .checkin-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .checkin-btn:disabled { background: #4ade80; }
    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      padding: 14px;
      background: #f9f9f9;
      border-radius: 10px;
      margin-bottom: 8px;
    }
    .leaderboard-item.current-user {
      background: #fde68a;
      border: 2px solid #fbbf24;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    .calendar-day {
      aspect-ratio: 1;
      background: #10b981;
      border-radius: 8px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .confetti {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 100px;
      z-index: 1000;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="loginScreen" class="container">
  <div class="card">
    <h1 style="text-align:center;margin-bottom:20px;">Gym Streak Tracker</h1>
    <div id="userButtons"></div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="container hidden">
  <div class="card">
    <h2 id="userName"></h2>
    <p id="currentDate"></p>

    <p>üî• Current Streak: <span id="currentStreak">0</span></p>
    <p>üèÜ Best Streak: <span id="longestStreak">0</span></p>
    <p>üìà Total Workouts: <span id="totalWorkouts">0</span></p>

    <button id="checkinBtn" class="checkin-btn" onclick="checkIn()">üî• Check in workout</button>

    <h3>Leaderboard</h3>
    <div id="leaderboardList"></div>

    <h3>Recent Activity</h3>
    <div id="calendarGrid" class="calendar-grid"></div>

    <button onclick="logout()">Logout</button>
  </div>
</div>

<script>
/* ================= DATA MODEL ================= */

const initialUsers = {
  prashant: { name: 'Prashant', workoutDates: [], currentStreak: 0, longestStreak: 0, lastCheckIn: null },
  vaibhav: { name: 'Vaibhav', workoutDates: [], currentStreak: 0, longestStreak: 0, lastCheckIn: null },
  shivanshi: { name: 'Shivanshi', workoutDates: [], currentStreak: 0, longestStreak: 0, lastCheckIn: null }
};

let users = {};
let currentUser = null;

/* ================= UTILITIES ================= */

function getToday() {
  return new Date().toISOString().split('T')[0];
}

function daysBetween(d1, d2) {
  return Math.floor((new Date(d2) - new Date(d1)) / (1000 * 60 * 60 * 24));
}

/* ================= STORAGE ================= */

function saveData() {
  localStorage.setItem('gymUsers', JSON.stringify(users));
}

function normalizeStreaks() {
  const today = getToday();
  Object.values(users).forEach(u => {
    if (u.lastCheckIn && daysBetween(u.lastCheckIn, today) > 1) {
      u.currentStreak = 0;
    }
  });
}

function loadData() {
  const stored = localStorage.getItem('gymUsers');
  users = stored ? JSON.parse(stored) : structuredClone(initialUsers);

  normalizeStreaks();
  saveData();

  const savedUser = localStorage.getItem('currentUser');
  if (savedUser) login(savedUser);
}

/* ================= LOGIN ================= */

function renderLoginScreen() {
  const box = document.getElementById('userButtons');
  box.innerHTML = '';
  Object.entries(users).forEach(([k, u]) => {
    const b = document.createElement('button');
    b.className = 'user-btn';
    b.innerHTML = `${u.name} <span class="streak-badge">üî• ${u.currentStreak}</span>`;
    b.onclick = () => login(k);
    box.appendChild(b);
  });
}

function login(username) {
  currentUser = username;
  localStorage.setItem('currentUser', username);
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  updateDashboard();
}

function logout() {
  currentUser = null;
  localStorage.removeItem('currentUser');
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('loginScreen').classList.remove('hidden');
  renderLoginScreen();
}

/* ================= CHECK-IN ================= */

function checkIn() {
  const today = getToday();
  const u = users[currentUser];
  if (u.workoutDates.includes(today)) return;

  if (!u.lastCheckIn) u.currentStreak = 1;
  else {
    const diff = daysBetween(u.lastCheckIn, today);
    u.currentStreak = diff === 1 ? u.currentStreak + 1 : 1;
  }

  u.lastCheckIn = today;
  u.longestStreak = Math.max(u.longestStreak, u.currentStreak);
  u.workoutDates.push(today);

  saveData();
  updateDashboard();

  if ([7,14,30,50,100].includes(u.currentStreak)) showConfetti();
}

/* ================= UI ================= */

function updateDashboard() {
  const u = users[currentUser];
  document.getElementById('userName').textContent = u.name;
  document.getElementById('currentDate').textContent = getToday();
  document.getElementById('currentStreak').textContent = u.currentStreak;
  document.getElementById('longestStreak').textContent = u.longestStreak;
  document.getElementById('totalWorkouts').textContent = u.workoutDates.length;

  const btn = document.getElementById('checkinBtn');
  if (u.workoutDates.includes(getToday())) {
    btn.disabled = true;
    btn.textContent = '‚úì Workout logged';
  } else {
    btn.disabled = false;
    btn.textContent = 'üî• Check in workout';
  }

  updateLeaderboard();
  updateCalendar();
}

function updateLeaderboard() {
  const list = document.getElementById('leaderboardList');
  list.innerHTML = '';
  Object.entries(users)
    .sort((a,b) => b[1].currentStreak - a[1].currentStreak)
    .forEach(([k,u]) => {
      const d = document.createElement('div');
      d.className = 'leaderboard-item' + (k === currentUser ? ' current-user' : '');
      d.innerHTML = `${u.name} <strong>üî• ${u.currentStreak}</strong>`;
      list.appendChild(d);
    });
}

function updateCalendar() {
  const grid = document.getElementById('calendarGrid');
  grid.innerHTML = '';
  users[currentUser].workoutDates.slice(-28).forEach(d => {
    const c = document.createElement('div');
    c.className = 'calendar-day';
    c.textContent = new Date(d).getDate();
    grid.appendChild(c);
  });
}

function showConfetti() {
  const c = document.createElement('div');
  c.className = 'confetti';
  c.textContent = 'üéâ';
  document.body.appendChild(c);
  setTimeout(() => c.remove(), 700);
}

/* ================= INIT ================= */

loadData();
renderLoginScreen();
</script>

</body>
</html>
